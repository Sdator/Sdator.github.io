# []()认识批处理乱码

---

* **`Unicode编码`以下简称 `U码`**  
* **`ASCII编码`以下简称 `A码`**

> ## 认识乱码

* 有时候我们以文本的方式打开别人制作的批处理进行参考学习，但常会显示乱码，这是作者为了防止别人查看，或者有心人故意插入了一些恶意代码，碰到了这种情况完全是因为系统编码的问题。

* 如果把文本十六进制方式打开，会发现前两字节是 `FF FE`或 `FE FF`，之后是一段批处理命令。大概就是这样子的

 
十六进制|ASCII
-|-
`FF FE 41 69 72 26 63 6C 73 0D 0A 40 65 63 68 6F` | `ÿþAir&cls[换行]@echo`

* 这里来分析一下，如果有`notepad`、`vscode`之类的编辑器可以先把文件拖进来打开，你会发现`编码方式`显示为`UCS-2 LE BOM`

* 刚好文件头前两字节是`FF FE`这个可是U码的`Little Endian(小端)标识`,那么当文本编辑器碰到这个会怎么处理呢，他会把以`双字节`为一个`字符`去解析。由于文本原来是以`A码`方式存储的，一个字符等于一个字节。比如：`e = 65`

?> 在`A码`中我们所看到的和`U码`就会识别成这样

十六进制|ASCII|十六进制|U码
-|-|-|-
`65 63 68 6F`|`echo`|`6563 686F`|`捥潨`

!> 这是什么鬼？

> **咦，这不就是我们所看到的`乱码`吗？没错，就是因为`读取长度`发生了`变化`,所以导致了我们看到的`乱码`**。

?> 不少朋友在玩小`黄油`的时候也会碰到这样的`问题`，其实就是因为`编码`的原因。系统把游戏的`编码`识别成了`其他方式`的编码就是`系统默认`的编码，导致我们所想的和所看到的`不同`。所以就要借助一些`工具`来帮助系统正常的`识别`原来的`编码`。

> ## 乱码生成原理

* 前两字节的问题我们解决了剩下的 `Air&cls[换行]@echo` 
* 正常来说只要我们在文件头添加`U码标识`就能使文件读取时`产生乱码`
* 但是我们为了批处理能更好的隐藏起来，就会添加这样一条语句上去 `Air&cls[换行]`，`Air`可以是任意的字符
* 我们用`批处理`的方式来读这条代码意思就是当 `Air` 这条代码`执行成功`后就会执行`cls`进行`清屏`，后面是一个换行这也是必须要加上的，因为`批处理`都是一行一行的去`解析`代码的。
* 这其中关键的地方就是`cls`和`换行`，如果不加上批处理也能执行但是交互画面看起来会变得很乱`不够美观`，给人第一眼就觉得你这个批处理是`有问题`的。所以我们要进行`清屏`处理。

> 好了要解释的就这么多下面要说怎样去`解决乱码`问题，突破`乱码加密` 让`源码`重见光明。

> ## 解决乱码

* 那么以上说的就是乱码出现的原因，接下来就是要解决批处理乱码的问题了。
* 首先用十六进制编辑器打开乱码的批处理程序
* 把前两字节[标识]`FF FE`或 `FE FF`去掉保存文件即可
* 为了更好的处理，我们还可以把`Air&cls[换行]` 去掉，因为这条命令和换行符对于源程序来说并没有太大的作用。

?>没错，就是这么简单。从上面学到的基础中相信大家就已经有了大致的解决方案了，基础就是这么重要。

> #### []()2018/09/14 PM By：Air